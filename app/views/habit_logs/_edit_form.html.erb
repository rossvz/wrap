<div class="flex items-center justify-between mb-4">
  <div>
    <p class="text-xs font-black uppercase tracking-widest">Edit time block</p>
    <p class="text-2xl font-black mt-1"><%= habit_log.time_range_display %></p>
  </div>
  <%= link_to dashboard_path, class: "nb-btn nb-btn--white", data: { turbo_frame: "edit_modal" } do %>
    ✕
  <% end %>
</div>

<%= form_with model: [habit, habit_log], data: { turbo_frame: "_top" } do |f| %>
  <% if habit_log.errors.any? %>
    <div class="nb-card nb-card--rose mb-4">
      <ul class="list-disc pl-4">
        <% habit_log.errors.full_messages.each do |msg| %>
          <li class="text-sm"><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Change habit -->
  <p class="text-xs font-black uppercase tracking-widest mb-3">Habit</p>
  <div class="grid gap-2 mb-6">
    <% habits.each do |h| %>
      <label class="nb-btn text-left justify-start habit-card cursor-pointer <%= 'ring-2 ring-black ring-offset-2' if h.id == habit_log.habit_id %>"
             style="background: <%= h.color_css_var %>;"
             data-token="<%= h.color_token %>">
        <%= f.radio_button :habit_id, h.id, class: "sr-only", data: { action: "change->form#submit" } %>
        <span class="inline-block w-3 h-3 border-2 border-black rounded-full mr-2 shrink-0"
              style="background: <%= h.color_css_var %>;"></span>
        <span class="truncate"><%= h.name %></span>
        <% if h.id == habit_log.habit_id %>
          <span class="ml-auto text-lg">✓</span>
        <% end %>
      </label>
    <% end %>
  </div>

  <!-- Adjust times -->
  <p class="text-xs font-black uppercase tracking-widest mb-3">Adjust time</p>
  <div class="flex gap-3 mb-6">
    <div class="flex-1">
      <label class="block text-xs font-bold mb-1">Start</label>
      <%= f.select :start_hour, hour_options_for_select(6, 23),
          { selected: habit_log.start_hour },
          class: "nb-input w-full" %>
    </div>
    <div class="flex-1">
      <label class="block text-xs font-bold mb-1">End</label>
      <%= f.select :end_hour, hour_options_for_select(7, 24),
          { selected: habit_log.end_hour },
          class: "nb-input w-full" %>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="flex gap-2">
    <%= link_to "Delete", habit_habit_log_path(habit, habit_log),
        method: :delete,
        data: { turbo_method: :delete, turbo_confirm: "Delete this time block?" },
        class: "nb-btn nb-btn--rose flex-1 text-center" %>
    <%= f.submit "Save", class: "nb-btn nb-btn--yellow flex-1 cursor-pointer" %>
  </div>
<% end %>
