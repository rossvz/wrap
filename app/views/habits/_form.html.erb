<%= form_with(model: habit, class: "contents") do |form| %>
  <% if habit.errors.any? %>
    <div id="error_explanation" class="nb-card nb-card--tight nb-card--alert mt-4">
      <h2><%= pluralize(habit.errors.count, "error") %> prohibited this habit from being saved:</h2>

      <ul class="list-disc ml-6">
        <% habit.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mt-6">
    <%= form.label :name, class: "nb-label" %>
    <%= form.text_field :name, class: "nb-input mt-2", placeholder: "Meditation" %>
  </div>

  <div class="mt-4">
    <%= form.label :description, class: "nb-label" %>
    <%= form.textarea :description, rows: 4, class: "nb-input mt-2", placeholder: "Why it matters, what countsâ€¦" %>
  </div>

  <div class="mt-4 grid gap-4 md:grid-cols-12" data-controller="color-picker">
    <div class="md:col-span-6">
      <%= form.label :color_token, "Card color", class: "nb-label" %>
      <%= form.hidden_field :color_token, data: { color_picker_target: "input" } %>
      
      <div class="mt-2 flex flex-wrap gap-2">
        <% Habit::COLOR_TOKENS.each do |token| %>
          <button type="button"
                  class="h-10 w-10 border-2 border-black habit-bg-<%= token %> transition-transform hover:scale-110 active:scale-95 cursor-pointer"
                  style="box-shadow: 2px 2px 0 #000;"
                  data-token="<%= token %>"
                  data-color-picker-target="colorButton"
                  data-action="click->color-picker#select"
                  title="Color <%= token %>">
          </button>
        <% end %>
      </div>
      <p class="mt-2 text-xs text-black/70 italic">Pick a color for your habit card. Colors adapt to your theme.</p>
    </div>

    <div class="md:col-span-6 flex items-end">
      <div class="mb-2 flex items-center gap-3">
        <%= form.check_box :active, class: "nb-input !w-5 !h-5" %>
        <%= form.label :active, "Active (show on dashboard)", class: "nb-label !text-sm !normal-case !tracking-normal" %>
      </div>
    </div>
  </div>

  <div class="mt-6 flex flex-col gap-2 sm:flex-row sm:items-center">
    <%= form.submit class: "nb-btn nb-btn--yellow" %>
    <%= link_to "Cancel", habits_path, class: "nb-btn nb-btn--white" %>
  </div>
<% end %>
