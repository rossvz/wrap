<%# Timeline Calendar - extracted for Turbo Stream replacement %>
<div id="timeline" class="nb-card relative overflow-hidden p-0">
  <!-- Mobile drag hint -->
  <div class="md:hidden flex items-center justify-center border-b-2 border-black bg-white px-3 py-2">
    <span class="text-xs font-bold text-black flex items-center gap-1">
      <span class="inline-block w-4 h-4 rounded bg-black/10 border border-dashed border-black/40 flex items-center justify-center text-[10px]">＋</span>
      Hold &amp; drag to log time
    </span>
  </div>
  <div class="timeline-container relative" data-time-block-target="timeline">
    <!-- All hour rows in one continuous grid -->
    <% (DaySummary::START_HOUR...DaySummary::END_HOUR).each do |hour| %>
      <% section = day.section_for_hour(hour) %>
      <% section_bg = day.section_background_for_hour(hour) %>
      <% if section %>
        <!-- Section header row -->
        <div class="sticky top-0 z-30 border-b-2 border-black bg-white/95 backdrop-blur px-4 py-2">
          <p class="text-sm font-black uppercase tracking-widest"><%= section[:name] %></p>
        </div>
      <% end %>
      <div class="timeline-hour flex border-b border-black/10 <%= section_bg %> <%= 'work-hour-bg' if day.work_hour?(hour) %> relative"
           style="height: 60px;"
           data-hour="<%= hour %>">
        <!-- Time label - scrollable area -->
        <div class="w-12 shrink-0 border-r border-black/10 bg-white/50 px-2 py-1">
          <span class="text-xs font-bold text-black/50"><%= format_hour(hour) %></span>
        </div>
        <!-- Main content area - scrollable on mobile, draggable on desktop -->
        <div class="flex-1 relative hour-content" data-hour="<%= hour %>"
             data-action="mousedown->time-block#startDrag">
          <!-- Existing time blocks for this hour -->
          <% day.time_blocks_for_hour(hour).each do |block| %>
            <%= link_to edit_habit_habit_log_path(block.habit, block),
                class: "absolute inset-x-1 z-10 rounded-lg border-2 border-black cursor-pointer transition-transform hover:scale-[1.02] habit-card block",
                style: "top: 0; height: #{time_block_height(block)}px; background: #{block.habit.color_css_var};",
                data: { token: block.habit.color_token, time_block: true, turbo_frame: "edit_modal" } do %>
              <div class="p-2 h-full flex flex-col">
                <p class="font-black text-sm truncate"><%= block.habit.name %></p>
                <% if block.show_extended_details? %>
                  <p class="text-xs opacity-70 mt-1"><%= block.time_range_display %></p>
                  <% if block.notes.present? %>
                    <p class="text-xs opacity-50 mt-auto truncate"><%= block.notes %></p>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
        <!-- Drag handle zone - for mobile touch dragging (narrower to reduce accidental touches) -->
        <div class="drag-handle w-10 shrink-0 border-l border-dashed border-black/20 flex items-center justify-center cursor-pointer"
             data-hour="<%= hour %>"
             data-action="touchstart->time-block#startTouchDrag mousedown->time-block#startDrag">
          <span class="text-base font-black text-black/40 select-none">＋</span>
        </div>
      </div>
    <% end %>
    <!-- Drag selection overlay - INSIDE the scrollable container -->
    <div data-time-block-target="selection"
         class="hidden absolute left-12 right-10 md:right-1 border-2 border-dashed rounded-lg z-20 pointer-events-none"
         style="top: 0; height: 60px; background: var(--accent-primary); opacity: 0.5; border-color: var(--accent-primary);">
    </div>
  </div>
  <!-- Instruction overlay when empty -->
  <% if day.time_blocks.empty? %>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-40">
      <div class="nb-card nb-card--tight bg-white/95 text-center max-w-xs">
        <p class="text-lg font-black hidden md:block">Drag to log time</p>
        <p class="text-lg font-black md:hidden">Hold ＋ to log time</p>
      </div>
    </div>
  <% end %>
</div>
