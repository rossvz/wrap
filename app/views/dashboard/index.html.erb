<% content_for :title, "Dashboard" %>

<div class="nb-page">
  <div class="nb-page-header">
    <div>
      <p class="text-xs font-black uppercase tracking-widest">Dashboard</p>
      <h1 class="mt-1 text-5xl font-black leading-tight">Time spent</h1>
      <p class="mt-2 text-sm text-black/70">Completion is a vibe. Minutes are evidence.</p>
    </div>

    <div class="nb-pill nb-pill--white">
      <span class="inline-block h-2 w-2 border-2 border-black bg-black"></span>
      <span><%= @date.to_s %></span>
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-4">
    <div class="nb-card" style="background: #a7f3d0">
      <p class="text-xs font-black uppercase tracking-widest">Today</p>
      <p class="mt-2 text-3xl font-black"><%= format_duration(@totals[:today]) %></p>
    </div>
    <div class="nb-card" style="background: #bfdbfe">
      <p class="text-xs font-black uppercase tracking-widest">This week</p>
      <p class="mt-2 text-3xl font-black"><%= format_duration(@totals[:week]) %></p>
    </div>
    <div class="nb-card" style="background: #fde68a">
      <p class="text-xs font-black uppercase tracking-widest">This month</p>
      <p class="mt-2 text-3xl font-black"><%= format_duration(@totals[:month]) %></p>
    </div>
    <div class="nb-card" style="background: #fbcfe8">
      <p class="text-xs font-black uppercase tracking-widest">All-time</p>
      <p class="mt-2 text-3xl font-black"><%= format_duration(@totals[:all_time]) %></p>
    </div>
  </div>

  <div class="nb-card">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <p class="text-xs font-black uppercase tracking-widest">Active habits</p>
        <h2 class="mt-1 text-3xl font-black leading-tight">Log minutes fast</h2>
        <p class="mt-1 text-sm text-black/70">One row per habit. One log per day.</p>
      </div>
      <%= link_to "Manage habits", habits_path, class: "nb-btn nb-btn--white" %>
    </div>

    <div class="mt-6 grid gap-4">
      <% if @habits.any? %>
        <% @habits.each do |habit| %>
          <div class="nb-card nb-card--tight" style="background: <%= habit.color %>">
            <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <div class="min-w-0">
                <div class="flex flex-wrap items-center gap-2">
                  <p class="text-xl font-black truncate"><%= habit.name %></p>
                  <div class="nb-pill nb-pill--white">
                    <span>Today: <%= format_duration(@minutes_by_habit[:today][habit.id].to_i) %></span>
                  </div>
                  <div class="nb-pill nb-pill--white">
                    <span>Week: <%= format_duration(@minutes_by_habit[:week][habit.id].to_i) %></span>
                  </div>
                  <div class="nb-pill nb-pill--white">
                    <span>All: <%= format_duration(@minutes_by_habit[:all_time][habit.id].to_i) %></span>
                  </div>
                </div>
                <% if habit.description.present? %>
                  <p class="mt-1 text-sm text-black/70"><%= habit.description %></p>
                <% end %>
              </div>

              <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
                <%= form_with url: habit_habit_logs_path(habit), scope: :habit_log, data: { turbo: false }, class: "flex items-center gap-2" do |form| %>
                  <%= form.hidden_field :logged_on, value: @date %>
                  <%= form.number_field :duration_minutes, min: 0, step: 1, class: "nb-input w-28", placeholder: "min" %>
                  <%= form.text_field :notes, class: "nb-input w-56", placeholder: "notes (optional)" %>
                  <%= form.submit "Log", class: "nb-btn nb-btn--white" %>
                <% end %>

                <%= link_to "Open", habit_path(habit), class: "nb-btn nb-btn--white" %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="font-bold">No active habits yet.</p>
        <p class="text-sm text-black/70">Create one and start tracking minutes.</p>
      <% end %>
    </div>
  </div>
</div>
